#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_FIELDS 20

int main() {
    FILE *file = fopen("C:\\data\\traffic_stats.csv", "r");
    if (file == NULL) {
        perror("파일 열기 실패");
        return 1;
    }

    char line[1024];
    int line_num = 0;

    // 헤더 출력
    printf("year,accident,dead,car,license\n");

    while (fgets(line, sizeof(line), file)) {
        line_num++;

        if (line_num < 3) continue;   // 3행 미만 건너뜀
        if (line_num > 12) break;     // 12행까지 처리

        // 줄 끝 개행 제거
        line[strcspn(line, "\r\n")] = 0;

        // CSV 필드 파싱
        char *fields[MAX_FIELDS];
        char *token = strtok(line, ",");
        int i = 0;

        while (token != NULL && i < MAX_FIELDS) {
            fields[i++] = token;
            token = strtok(NULL, ",");
        }

        // 필요한 인덱스 확인
        // 안전하게 인덱스 존재 여부 체크
        if (i > 10) {
            printf("%s,%s,%s,%s,%s\n",
                   fields[0],   // year (1열)
                   fields[1],   // accident (2열)
                   fields[3],   // dead (4열)
                   fields[6],   // car (7열)
                   fields[10]); // license (11열)
        }
    }

    fclose(file);
    return 0;
}
